# 📋 PRD: ระบบสั่งซื้อสินค้าและใบเสร็จ (Purchase Order & Receipt System)

## 📌 Document Information
- **Project:** POS System - Purchase Order & Receipt Module
- **Version:** 1.0
- **Date:** 2025-10-04
- **Author:** Product Owner
- **Status:** Draft

---

## 🎯 Executive Summary

เพิ่ม 2 ระบบหลักในระบบ POS:
1. **ระบบสั่งซื้อสินค้า (Purchase Order System)** - จัดการการสั่งซื้อสินค้าจากซัพพลายเออร์
2. **ระบบใบเสร็จ (Receipt/Invoice System)** - ใบเสร็จสวยงาม พิมพ์ได้ด้วยเครื่องปริ้น

---

## 🔍 Problem Statement

### ปัญหาปัจจุบัน
1. **ไม่มีระบบสั่งซื้อสินค้า** - ต้องสั่งซื้อนอกระบบ ไม่มีประวัติ
2. **ใบเสร็จไม่สวย** - ใบเสร็จปัจจุบันอาจไม่เหมาะกับการพิมพ์
3. **ไม่มีการติดตามสต็อก** - เมื่อสั่งซื้อแล้วต้องเพิ่มสต็อกด้วยตนเอง

### ผลกระทบ
- ไม่สามารถติดตามการสั่งซื้อได้
- ไม่ทราบว่าสั่งซื้อจากซัพพลายเออร์ไหน เมื่อไหร่ ราคาเท่าไหร่
- ใบเสร็จไม่เป็นมาตรฐาน

---

## 📊 Feature Requirements

## 1. ระบบสั่งซื้อสินค้า (Purchase Order System)

### 1.1 หน้ารายการสั่งซื้อ (Purchase Orders List)

#### Layout
```
┌─────────────────────────────────────────────────────────────┐
│  📦 รายการสั่งซื้อสินค้า (Purchase Orders)                   │
├─────────────────────────────────────────────────────────────┤
│  📊 สรุป                                                     │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐        │
│  │ รอดำเนินการ  │ │ กำลังจัดส่ง   │ │ เสร็จสิ้น     │        │
│  │ 5 รายการ     │ │ 3 รายการ     │ │ 25 รายการ    │        │
│  └──────────────┘ └──────────────┘ └──────────────┘        │
├─────────────────────────────────────────────────────────────┤
│  [ค้นหา...] [กรองตามสถานะ▼] [กรองตามซัพพลายเออร์▼]         │
│  [ส่งออก Excel] [+ สร้างใบสั่งซื้อใหม่]                     │
├─────────────────────────────────────────────────────────────┤
│  ตารางรายการสั่งซื้อ                                         │
└─────────────────────────────────────────────────────────────┘
```

#### ตารางรายการสั่งซื้อ

| คอลัมน์ | ประเภท | คำอธิบาย | Required |
|---------|--------|----------|----------|
| เลขที่ PO | Text | PO-YYYY-XXXX | ✅ |
| วันที่สั่งซื้อ | Date | วันที่สร้าง PO | ✅ |
| ซัพพลายเออร์ | Text | ชื่อผู้จัดจำหน่าย | ✅ |
| รายการสินค้า | Number | จำนวนรายการ | ✅ |
| ยอดรวม | Decimal | ยอดเงินรวม | ✅ |
| สถานะ | Badge | Draft/Pending/Shipping/Received/Cancelled | ✅ |
| วันที่คาดว่าจะได้รับ | Date | Expected Delivery Date | ❌ |
| หมายเหตุ | Text | บันทึกเพิ่มเติม | ❌ |
| Actions | Buttons | ดู/แก้ไข/ยกเลิก/รับสินค้า | ✅ |

#### สถานะใบสั่งซื้อ (PO Status)
- 📝 **Draft** - ร่าง (ยังไม่ส่ง)
- 🟡 **Pending** - รอดำเนินการ (ส่งแล้ว รอซัพพลายเออร์ยืนยัน)
- 🚚 **Shipping** - กำลังจัดส่ง
- ✅ **Received** - รับสินค้าแล้ว
- ❌ **Cancelled** - ยกเลิก

### 1.2 ฟอร์มสร้างใบสั่งซื้อ (Create Purchase Order)

#### Layout
```
┌─────────────────────────────────────────────────────────────┐
│  📦 สร้างใบสั่งซื้อสินค้า                                    │
├─────────────────────────────────────────────────────────────┤
│  ข้อมูลทั่วไป                                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ เลขที่ PO: [PO-2025-0001] (Auto)                   │   │
│  │ วันที่สั่งซื้อ: [2025-10-04] *                     │   │
│  │ ซัพพลายเออร์: [เลือกซัพพลายเออร์▼] *              │   │
│  │   - ชื่อ: บริษัท ABC จำกัด                         │   │
│  │   - เบอร์โทร: 02-xxx-xxxx                          │   │
│  │   - อีเมล: abc@example.com                         │   │
│  │ วันที่คาดว่าจะได้รับ: [2025-10-14]                 │   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│  รายการสินค้า                                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [ค้นหาสินค้า...] [+ เพิ่มสินค้าใหม่]              │   │
│  │                                                      │   │
│  │ ┌────────────────────────────────────────────────┐ │   │
│  │ │ สินค้า         │ จำนวน │ ราคา/หน่วย │ รวม   │ │   │
│  │ ├────────────────────────────────────────────────┤ │   │
│  │ │ ปูนซีเมนต์ 50kg│ [100] │ [250.00]  │ 25,000│🗑│ │   │
│  │ │ อิฐมอญ         │ [500] │ [3.50]    │ 1,750 │🗑│ │   │
│  │ │ ทราย 1 คิว     │ [10]  │ [500.00]  │ 5,000 │🗑│ │   │
│  │ └────────────────────────────────────────────────┘ │   │
│  │                                                      │   │
│  │ [+ เพิ่มรายการสินค้า]                               │   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│  สรุปยอด                                                     │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ยอดรวมสินค้า:                          31,750 บาท  │   │
│  │ ส่วนลด:                    [_____] บาท  0 บาท      │   │
│  │ ภาษีมูลค่าเพิ่ม (VAT 7%):              2,222.50 บาท│   │
│  │ ────────────────────────────────────────────────    │   │
│  │ ยอดรวมสุทธิ:                           33,972.50 บาท│   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│  หมายเหตุ                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [กรุณาจัดส่งภายในวันที่ 14 ตุลาคม 2025]            │   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│  แนบเอกสาร                                                  │
│  [📎 อัปโหลดไฟล์] (PDF, Excel, รูปภาพ)                     │
├─────────────────────────────────────────────────────────────┤
│  [บันทึกร่าง] [ส่งใบสั่งซื้อ] [ยกเลิก]                     │
└─────────────────────────────────────────────────────────────┘
```

### 1.3 หน้ารายละเอียดใบสั่งซื้อ (PO Details)

#### Layout
```
┌─────────────────────────────────────────────────────────────┐
│  📦 ใบสั่งซื้อ PO-2025-0001                                  │
│  สถานะ: [🚚 กำลังจัดส่ง]                                    │
├─────────────────────────────────────────────────────────────┤
│  ข้อมูลทั่วไป                                                │
│  ┌──────────────────┐  ┌──────────────────┐                │
│  │ วันที่สั่งซื้อ    │  │ วันที่คาดว่าได้รับ│                │
│  │ 4 ต.ค. 2025     │  │ 14 ต.ค. 2025    │                │
│  └──────────────────┘  └──────────────────┘                │
│                                                              │
│  ซัพพลายเออร์: บริษัท ABC จำกัด                            │
│  เบอร์โทร: 02-xxx-xxxx                                      │
│  อีเมล: abc@example.com                                     │
├─────────────────────────────────────────────────────────────┤
│  รายการสินค้า                                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ สินค้า         │ จำนวน │ ราคา/หน่วย │ รวม       │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ ปูนซีเมนต์ 50kg│ 100   │ 250.00     │ 25,000.00 │   │
│  │ อิฐมอญ         │ 500   │ 3.50       │ 1,750.00  │   │
│  │ ทราย 1 คิว     │ 10    │ 500.00     │ 5,000.00  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  ยอดรวม: 31,750.00 บาท                                      │
│  VAT 7%: 2,222.50 บาท                                       │
│  ยอดสุทธิ: 33,972.50 บาท                                    │
├─────────────────────────────────────────────────────────────┤
│  Timeline                                                    │
│  ✅ สร้างใบสั่งซื้อ - 4 ต.ค. 2025 10:30                    │
│  ✅ ส่งใบสั่งซื้อ - 4 ต.ค. 2025 10:35                      │
│  🚚 กำลังจัดส่ง - 5 ต.ค. 2025 14:00                        │
│  ⏳ รอรับสินค้า                                              │
├─────────────────────────────────────────────────────────────┤
│  Actions                                                     │
│  [📄 พิมพ์ PO] [📧 ส่งอีเมล] [✅ รับสินค้า] [❌ ยกเลิก]    │
└─────────────────────────────────────────────────────────────┘
```

### 1.4 ฟอร์มรับสินค้า (Receive Goods)

#### Layout
```
┌─────────────────────────────────────────────────────────────┐
│  ✅ รับสินค้า - PO-2025-0001                                 │
├─────────────────────────────────────────────────────────────┤
│  วันที่รับสินค้า: [2025-10-14] *                            │
│  ผู้รับสินค้า: [ชื่อผู้รับ] *                                │
├─────────────────────────────────────────────────────────────┤
│  ตรวจสอบรายการสินค้า                                        │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ สินค้า      │สั่ง│รับจริง│ขาด/เกิน│สภาพ│หมายเหตุ│   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ปูนซีเมนต์   │100 │[100]  │ 0      │[ดี▼]│        │   │
│  │อิฐมอญ       │500 │[495]  │-5      │[ดี▼]│แตก 5 ก้อน│   │
│  │ทราย 1 คิว   │10  │[10]   │ 0      │[ดี▼]│        │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  สภาพสินค้า:                                                │
│  - ดี (Good)                                                 │
│  - ชำรุดบางส่วน (Partially Damaged)                         │
│  - ชำรุดทั้งหมด (Fully Damaged)                             │
├─────────────────────────────────────────────────────────────┤
│  ☑️ อัปเดตสต็อกสินค้าอัตโนมัติ                              │
│  ☑️ สร้างรายการสินค้าใหม่ถ้ายังไม่มีในระบบ                 │
├─────────────────────────────────────────────────────────────┤
│  หมายเหตุการรับสินค้า                                       │
│  [รับสินค้าครบถ้วน ยกเว้นอิฐมอญแตก 5 ก้อน]                 │
├─────────────────────────────────────────────────────────────┤
│  แนบหลักฐาน (รูปภาพสินค้า, ใบส่งของ)                       │
│  [📎 อัปโหลดไฟล์]                                           │
├─────────────────────────────────────────────────────────────┤
│  [ยกเลิก] [ยืนยันรับสินค้า]                                 │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. ระบบใบเสร็จ (Receipt/Invoice System)

### 2.1 ใบเสร็จแบบ A4 (สำหรับพิมพ์เครื่องปริ้นทั่วไป)

#### Layout (A4 Size - 210mm x 297mm)
```
┌─────────────────────────────────────────────────────────────┐
│                                                              │
│  ┌────────────────────────────────────────────────────┐     │
│  │         [โลโก้ร้าน]                                │     │
│  │    ร้าน ABC วัสดุก่อสร้าง                          │     │
│  │    123 ถ.สุขุมวิท แขวงคลองเตย กรุงเทพฯ 10110      │     │
│  │    โทร: 02-xxx-xxxx | Line: @abcshop              │     │
│  │    เลขประจำตัวผู้เสียภาษี: 0-1234-56789-01-2      │     │
│  └────────────────────────────────────────────────────┘     │
│                                                              │
│  ┌────────────────────────────────────────────────────┐     │
│  │              ใบเสร็จรับเงิน / ใบกำกับภาษี          │     │
│  │                 TAX INVOICE / RECEIPT               │     │
│  └────────────────────────────────────────────────────┘     │
│                                                              │
│  เลขที่: SALE-2025-0001              วันที่: 4 ต.ค. 2025   │
│  ผู้ขาย: นายสมชาย ใจดี              เวลา: 14:30:25        │
│                                                              │
│  ลูกค้า: นายสมศักดิ์ รักดี                                  │
│  เบอร์โทร: 081-xxx-xxxx                                     │
│  ที่อยู่: 456 ถ.พระราม 4 กรุงเทพฯ                          │
│                                                              │
│  ┌────────────────────────────────────────────────────┐     │
│  │ ลำดับ│ รายการ        │ จำนวน│ ราคา/หน่วย│  รวม   │     │
│  ├────────────────────────────────────────────────────┤     │
│  │  1   │ ปูนซีเมนต์ 50kg│  10  │   250.00  │ 2,500.00│     │
│  │  2   │ อิฐมอญ         │ 100  │     3.50  │   350.00│     │
│  │  3   │ ทราย 1 คิว     │   2  │   500.00  │ 1,000.00│     │
│  │  4   │ หินเกล็ด 1 คิว │   1  │   600.00  │   600.00│     │
│  └────────────────────────────────────────────────────┘     │
│                                                              │
│                                      ยอดรวม:    4,450.00 บาท│
│                                      ส่วนลด:        0.00 บาท│
│                                      ยอดหลังหัก: 4,450.00 บาท│
│                                      VAT 7%:      311.50 บาท│
│                                      ────────────────────────│
│                                      ยอดสุทธิ:  4,761.50 บาท│
│                                                              │
│  วิธีการชำระเงิน: เงินสด                                     │
│  รับเงิน:                                        5,000.00 บาท│
│  เงินทอน:                                          238.50 บาท│
│                                                              │
│  ┌────────────────────────────────────────────────────┐     │
│  │              [QR Code สำหรับชำระเงิน]              │     │
│  │                  PromptPay                          │     │
│  └────────────────────────────────────────────────────┘     │
│                                                              │
│  หมายเหตุ: กรุณาตรวจสอบสินค้าก่อนออกจากร้าน               │
│            สินค้าที่ซื้อแล้วไม่รับเปลี่ยน/คืน              │
│                                                              │
│  ลงชื่อผู้รับเงิน: ________________                         │
│                                                              │
│  ────────────────────────────────────────────────────────   │
│         ขอบคุณที่ใช้บริการ - Thank You!                     │
│         www.abcshop.com | Facebook: ABCShop                 │
│  ────────────────────────────────────────────────────────   │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 ใบเสร็จแบบ Thermal (80mm - เครื่องปริ้นความร้อน)

#### Layout (80mm width)
```
┌────────────────────────────────┐
│      [โลโก้ร้าน]               │
│   ร้าน ABC วัสดุก่อสร้าง       │
│ 123 ถ.สุขุมวิท กรุงเทพฯ 10110 │
│   โทร: 02-xxx-xxxx             │
│ เลขประจำตัวผู้เสียภาษี:        │
│   0-1234-56789-01-2            │
├────────────────────────────────┤
│     ใบเสร็จรับเงิน              │
│     TAX INVOICE                │
├────────────────────────────────┤
│ เลขที่: SALE-2025-0001         │
│ วันที่: 4 ต.ค. 2025 14:30:25  │
│ ผู้ขาย: นายสมชาย ใจดี          │
├────────────────────────────────┤
│ ลูกค้า: นายสมศักดิ์ รักดี      │
│ เบอร์: 081-xxx-xxxx            │
├────────────────────────────────┤
│ รายการ                         │
├────────────────────────────────┤
│ ปูนซีเมนต์ 50kg                │
│   10 x 250.00      2,500.00    │
│                                 │
│ อิฐมอญ                          │
│  100 x 3.50          350.00    │
│                                 │
│ ทราย 1 คิว                     │
│    2 x 500.00      1,000.00    │
│                                 │
│ หินเกล็ด 1 คิว                 │
│    1 x 600.00        600.00    │
├────────────────────────────────┤
│ ยอดรวม:           4,450.00 บาท│
│ ส่วนลด:               0.00 บาท│
│ ยอดหลังหัก:       4,450.00 บาท│
│ VAT 7%:             311.50 บาท│
│ ────────────────────────────   │
│ ยอดสุทธิ:         4,761.50 บาท│
├────────────────────────────────┤
│ วิธีชำระ: เงินสด                │
│ รับเงิน:          5,000.00 บาท│
│ เงินทอน:            238.50 บาท│
├────────────────────────────────┤
│      [QR Code PromptPay]       │
├────────────────────────────────┤
│ หมายเหตุ:                      │
│ กรุณาตรวจสอบสินค้าก่อนออก     │
│ จากร้าน สินค้าที่ซื้อแล้ว      │
│ ไม่รับเปลี่ยน/คืน              │
├────────────────────────────────┤
│   ขอบคุณที่ใช้บริการ            │
│   www.abcshop.com              │
├────────────────────────────────┤
│ พิมพ์เมื่อ: 4 ต.ค. 2025 14:30│
└────────────────────────────────┘
```

### 2.3 ฟีเจอร์ใบเสร็จ

#### ฟีเจอร์หลัก
- ✅ **พิมพ์ได้ 2 แบบ:** A4 และ Thermal (80mm)
- ✅ **QR Code PromptPay** สำหรับชำระเงิน
- ✅ **Barcode** เลขที่ใบเสร็จ
- ✅ **โลโก้ร้าน** แสดงด้านบน
- ✅ **ข้อมูลร้าน** ชื่อ, ที่อยู่, เบอร์โทร, เลขประจำตัวผู้เสียภาษี
- ✅ **ข้อมูลลูกค้า** ชื่อ, เบอร์โทร, ที่อยู่
- ✅ **รายการสินค้า** แสดงครบถ้วน
- ✅ **คำนวณภาษี** VAT 7%
- ✅ **แสดงเงินทอน** ถ้าจ่ายเงินสด
- ✅ **หมายเหตุ** ข้อความเตือน/ข้อมูลเพิ่มเติม
- ✅ **พิมพ์ซ้ำได้** จากประวัติการขาย
- ✅ **ส่งอีเมล** ส่งใบเสร็จทาง Email
- ✅ **ดาวน์โหลด PDF** บันทึกเป็น PDF

#### การตั้งค่าใบเสร็จ (Receipt Settings)
```
┌─────────────────────────────────────────┐
│  ⚙️ ตั้งค่าใบเสร็จ                      │
├─────────────────────────────────────────┤
│  ข้อมูลร้าน                             │
│  ชื่อร้าน: [_______________]            │
│  ที่อยู่: [_______________]             │
│  เบอร์โทร: [_______________]           │
│  อีเมล: [_______________]              │
│  เว็บไซต์: [_______________]           │
│  Facebook: [_______________]           │
│  Line ID: [_______________]            │
│  เลขประจำตัวผู้เสียภาษี: [___________] │
│  โลโก้ร้าน: [📎 อัปโหลด]              │
├─────────────────────────────────────────┤
│  PromptPay                              │
│  เลขบัญชี/เบอร์โทร: [_______________] │
│  ชื่อบัญชี: [_______________]          │
│  ☑️ แสดง QR Code ในใบเสร็จ             │
├─────────────────────────────────────────┤
│  การแสดงผล                              │
│  ☑️ แสดงโลโก้                          │
│  ☑️ แสดงข้อมูลลูกค้า                   │
│  ☑️ แสดง VAT                           │
│  ☑️ แสดง QR Code                       │
│  ☑️ แสดง Barcode                       │
│  ☑️ แสดงหมายเหตุ                       │
├─────────────────────────────────────────┤
│  ข้อความหมายเหตุ                        │
│  [กรุณาตรวจสอบสินค้าก่อนออกจากร้าน]   │
│  [สินค้าที่ซื้อแล้วไม่รับเปลี่ยน/คืน]  │
├─────────────────────────────────────────┤
│  ประเภทเครื่องปริ้น                     │
│  ⚫ A4 Printer (210mm x 297mm)         │
│  ⚪ Thermal Printer (80mm)             │
│  ⚪ Thermal Printer (58mm)             │
├─────────────────────────────────────────┤
│  [บันทึก] [ทดสอบพิมพ์]                 │
└─────────────────────────────────────────┘
```

---

## 🗄️ Database Schema

### 1. ตาราง `purchase_orders` (ใบสั่งซื้อ)

```sql
CREATE TABLE purchase_orders (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    po_number VARCHAR(50) UNIQUE NOT NULL COMMENT 'เลขที่ PO: PO-YYYY-XXXX',
    supplier_id BIGINT UNSIGNED NOT NULL COMMENT 'FK to suppliers',
    order_date DATE NOT NULL COMMENT 'วันที่สั่งซื้อ',
    expected_delivery_date DATE NULL COMMENT 'วันที่คาดว่าจะได้รับ',
    received_date DATE NULL COMMENT 'วันที่รับสินค้าจริง',
    subtotal DECIMAL(15,2) NOT NULL COMMENT 'ยอดรวมก่อน VAT',
    discount_amount DECIMAL(15,2) DEFAULT 0 COMMENT 'ส่วนลด',
    vat_amount DECIMAL(15,2) DEFAULT 0 COMMENT 'ภาษีมูลค่าเพิ่ม',
    total_amount DECIMAL(15,2) NOT NULL COMMENT 'ยอดรวมสุทธิ',
    status ENUM('draft', 'pending', 'shipping', 'received', 'cancelled') DEFAULT 'draft',
    notes TEXT NULL COMMENT 'หมายเหตุ',
    document_path VARCHAR(255) NULL COMMENT 'เอกสารแนบ',
    created_by BIGINT UNSIGNED NULL,
    updated_by BIGINT UNSIGNED NULL,
    received_by BIGINT UNSIGNED NULL COMMENT 'ผู้รับสินค้า',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (updated_by) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (received_by) REFERENCES users(id) ON DELETE SET NULL,
    
    INDEX idx_supplier (supplier_id),
    INDEX idx_status (status),
    INDEX idx_order_date (order_date),
    INDEX idx_po_number (po_number)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 2. ตาราง `purchase_order_items` (รายการสินค้าในใบสั่งซื้อ)

```sql
CREATE TABLE purchase_order_items (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    po_id BIGINT UNSIGNED NOT NULL COMMENT 'FK to purchase_orders',
    product_id BIGINT UNSIGNED NULL COMMENT 'FK to products',
    product_name VARCHAR(255) NOT NULL COMMENT 'ชื่อสินค้า',
    quantity_ordered DECIMAL(10,2) NOT NULL COMMENT 'จำนวนที่สั่ง',
    quantity_received DECIMAL(10,2) DEFAULT 0 COMMENT 'จำนวนที่รับจริง',
    unit_price DECIMAL(15,2) NOT NULL COMMENT 'ราคาต่อหน่วย',
    total_price DECIMAL(15,2) NOT NULL COMMENT 'ราคารวม',
    condition_status ENUM('good', 'partial_damaged', 'fully_damaged') DEFAULT 'good' COMMENT 'สภาพสินค้า',
    notes TEXT NULL COMMENT 'หมายเหตุ',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (po_id) REFERENCES purchase_orders(id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE SET NULL,
    
    INDEX idx_po (po_id),
    INDEX idx_product (product_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 3. ตาราง `receipt_settings` (การตั้งค่าใบเสร็จ)

```sql
CREATE TABLE receipt_settings (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    shop_name VARCHAR(255) NOT NULL,
    shop_address TEXT NOT NULL,
    shop_phone VARCHAR(50) NOT NULL,
    shop_email VARCHAR(100) NULL,
    shop_website VARCHAR(255) NULL,
    shop_facebook VARCHAR(255) NULL,
    shop_line_id VARCHAR(100) NULL,
    tax_id VARCHAR(50) NULL COMMENT 'เลขประจำตัวผู้เสียภาษี',
    logo_path VARCHAR(255) NULL,
    promptpay_number VARCHAR(50) NULL,
    promptpay_name VARCHAR(255) NULL,
    show_logo BOOLEAN DEFAULT TRUE,
    show_customer_info BOOLEAN DEFAULT TRUE,
    show_vat BOOLEAN DEFAULT TRUE,
    show_qr_code BOOLEAN DEFAULT TRUE,
    show_barcode BOOLEAN DEFAULT TRUE,
    show_notes BOOLEAN DEFAULT TRUE,
    receipt_notes TEXT NULL,
    printer_type ENUM('a4', 'thermal_80mm', 'thermal_58mm') DEFAULT 'a4',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

## 🎨 UI/UX Requirements

### Design Principles
1. **ใช้งานง่าย** - ฟอร์มที่เข้าใจง่าย
2. **ใบเสร็จสวยงาม** - Professional และอ่านง่าย
3. **พิมพ์ได้จริง** - รองรับเครื่องปริ้นทั่วไป
4. **Responsive** - รองรับทุกอุปกรณ์

### Color Coding (PO Status)
- 📝 **เทา (Gray)** - Draft
- 🟡 **เหลือง (Yellow)** - Pending
- 🚚 **น้ำเงิน (Blue)** - Shipping
- ✅ **เขียว (Green)** - Received
- ❌ **แดง (Red)** - Cancelled

---

## 🔐 Access Control

### Role Permissions

| Feature | Admin | Manager | Accountant | Cashier |
|---------|-------|---------|------------|---------|
| ดูใบสั่งซื้อ | ✅ | ✅ | ✅ | ❌ |
| สร้างใบสั่งซื้อ | ✅ | ✅ | ✅ | ❌ |
| แก้ไขใบสั่งซื้อ | ✅ | ✅ | ✅ | ❌ |
| ยกเลิกใบสั่งซื้อ | ✅ | ✅ | ❌ | ❌ |
| รับสินค้า | ✅ | ✅ | ✅ | ❌ |
| พิมพ์ใบเสร็จ | ✅ | ✅ | ✅ | ✅ |
| ตั้งค่าใบเสร็จ | ✅ | ✅ | ❌ | ❌ |

---

## 📱 API Endpoints

### Purchase Orders

```
GET    /api/purchase-orders              # List all POs
GET    /api/purchase-orders/{id}         # Get PO details
POST   /api/purchase-orders              # Create PO
PUT    /api/purchase-orders/{id}         # Update PO
DELETE /api/purchase-orders/{id}         # Delete PO (only draft)
POST   /api/purchase-orders/{id}/send    # Send PO (draft → pending)
POST   /api/purchase-orders/{id}/receive # Receive goods
POST   /api/purchase-orders/{id}/cancel  # Cancel PO
GET    /api/purchase-orders/{id}/pdf     # Download PDF
```

### Receipts

```
GET    /api/receipts/settings            # Get receipt settings
PUT    /api/receipts/settings            # Update receipt settings
GET    /api/receipts/{sale_id}/preview   # Preview receipt
GET    /api/receipts/{sale_id}/print     # Print receipt
GET    /api/receipts/{sale_id}/pdf       # Download PDF
POST   /api/receipts/{sale_id}/email     # Send email
```

---

## 🚀 Implementation Plan

### Phase 1: Purchase Order System (Week 1-2)
- [ ] สร้าง Database (Migrations)
- [ ] สร้าง Models & Controllers
- [ ] สร้างหน้า PO List
- [ ] สร้างฟอร์มสร้าง PO
- [ ] สร้างหน้า PO Details
- [ ] สร้างฟอร์มรับสินค้า
- [ ] Auto update stock เมื่อรับสินค้า

### Phase 2: Receipt System (Week 3)
- [ ] สร้างตาราง receipt_settings
- [ ] สร้างหน้าตั้งค่าใบเสร็จ
- [ ] ออกแบบ Template ใบเสร็จ A4
- [ ] ออกแบบ Template ใบเสร็จ Thermal
- [ ] เพิ่ม QR Code PromptPay
- [ ] เพิ่ม Barcode
- [ ] ระบบพิมพ์

### Phase 3: Integration & Testing (Week 4)
- [ ] เชื่อมโยงกับระบบเดิม
- [ ] ทดสอบการพิมพ์จริง
- [ ] ทดสอบ PDF Download
- [ ] ทดสอบส่ง Email
- [ ] UAT Testing

---

## ✅ Acceptance Criteria

### Must Have
- [ ] สามารถสร้างใบสั่งซื้อได้
- [ ] สามารถรับสินค้าและอัปเดตสต็อกอัตโนมัติ
- [ ] ใบเสร็จสวยงาม พิมพ์ได้ชัดเจน
- [ ] รองรับเครื่องปริ้น A4 และ Thermal
- [ ] แสดง QR Code PromptPay
- [ ] คำนวณ VAT ถูกต้อง

### Should Have
- [ ] ส่งใบเสร็จทาง Email
- [ ] Download PDF
- [ ] พิมพ์ซ้ำได้จากประวัติ

### Nice to Have
- [ ] บาร์โค้ดสแกนสินค้า
- [ ] Integration กับ Line Notify
- [ ] SMS แจ้งเตือน

---

## 📚 Technical Stack

### Frontend
- Vue.js 3 (existing)
- Print.js หรือ html2pdf.js สำหรับพิมพ์
- QRCode.js สำหรับ QR Code
- JsBarcode สำหรับ Barcode

### Backend
- Laravel 8 (existing)
- DomPDF หรือ TCPDF สำหรับ PDF
- SimpleSoftwareIO/simple-qrcode สำหรับ QR Code

---

**Document Version:** 1.0  
**Last Updated:** 2025-10-04  
**Estimated Time:** 4 สัปดาห์  
**Priority:** High
