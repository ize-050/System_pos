import{u as L,r as v,o as H,D as K,b as O,E as Q,a as i,c as G,w as V,d as t,t as r,j,m as y,k as a,x as F,p as J,e as p,v as x,g as d,i as f,F as U,h as B,s as W}from"./app-6a986ce6.js";import{A as X}from"./AppLayout-c0397362.js";/* empty css            */import"./ApplicationLogo-88d45659.js";import"./_plugin-vue_export-helper-c27b6911.js";const Y={class:"flex justify-between items-center"},Z={class:"font-semibold text-xl text-gray-800 leading-tight"},tt={class:"space-x-2"},et={class:"py-12"},st={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ot={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},nt={class:"lg:col-span-2"},lt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},at={class:"p-6"},rt={class:"mb-4 relative"},it={class:"relative"},dt={key:0,class:"absolute right-3 top-3.5"},ut={key:0,class:"text-xs text-gray-500 mt-1 ml-1"},ct={key:0,class:"mb-6 max-h-80 overflow-y-auto border-2 border-green-200 rounded-lg shadow-lg bg-white"},mt=["onClick"],pt={class:"flex justify-between items-center"},gt={class:"flex-1"},_t={class:"font-semibold text-gray-900"},xt={class:"flex items-center gap-4 mt-1 text-sm text-gray-600"},bt={class:"flex items-center"},vt={class:"ml-1"},yt={class:"flex items-center"},ht={class:"ml-1"},ft={key:0,class:"text-xs bg-gray-100 px-2 py-1 rounded"},wt={key:1,class:"mb-6 p-4 border-2 border-gray-200 rounded-lg bg-gray-50 text-center text-gray-500"},kt={key:2},Ct={class:"space-y-3"},Vt={class:"flex-1"},qt={class:"font-medium"},Mt={class:"text-sm text-gray-500"},St={class:"flex items-center space-x-2"},jt=["onClick"],Ft=["onUpdate:modelValue","max","onInput"],Ut=["onClick"],Bt={class:"text-right"},Et={class:"font-medium"},It=["onClick"],Tt={key:3,class:"text-center py-8 text-gray-500"},$t={class:"space-y-6"},At={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},zt={class:"p-6"},Nt={class:"space-y-4"},Pt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Rt={class:"p-6"},Dt={class:"space-y-3"},Lt={class:"flex justify-between"},Ht={class:"flex justify-between items-center"},Kt={class:"flex justify-between items-center p-3 bg-blue-50 rounded-lg border border-blue-200"},Ot={class:"flex items-center space-x-2"},Qt={class:"text-sm font-semibold text-blue-700"},Gt={class:"border-t pt-3"},Jt={class:"flex justify-between text-lg font-bold"},Wt={class:"text-green-600"},Xt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Yt={class:"p-6"},Zt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},te={class:"p-6"},ee=["disabled"],re={__name:"Edit",props:{sale:Object,errors:Object},setup(q){var M,S;const l=q,s=L({customer_id:l.sale.customer_id||null,customer_name:l.sale.customer?l.sale.customer.name||l.sale.customer.company_name:"",customer_phone:((M=l.sale.customer)==null?void 0:M.phone)||"",customer_email:((S=l.sale.customer)==null?void 0:S.email)||"",items:[],subtotal:l.sale.subtotal||0,tax_amount:l.sale.tax_amount||0,discount_amount:l.sale.discount_amount||0,total_amount:l.sale.total_amount||0,payment_method:l.sale.payment_method||"cash",payment_received:l.sale.payment_received||0,change_amount:l.sale.change_amount||0,notes:l.sale.notes||"",promotion_id:l.sale.promotion_id||null}),u=v(""),g=v([]),w=v(l.sale.tax_amount>0),k=v(!1),h=v(!1),E=v(null);H(()=>{l.sale.sale_items&&l.sale.sale_items.length>0&&(s.items=l.sale.sale_items.map(n=>{var e,o;return{product_id:n.product_id,product_name:((e=n.product)==null?void 0:e.name)||"Unknown Product",quantity:n.quantity,unit_price:n.unit_price,total_price:n.total_price,max_quantity:(((o=n.product)==null?void 0:o.current_stock)||0)+n.quantity}}),c())});const I=K.debounce(async()=>{if(u.value.length>=2){h.value=!0;try{const n=await O.get(route("sales.search-products"),{params:{search:u.value}});g.value=n.data}catch(n){console.error("Error searching products:",n),g.value=[]}finally{h.value=!1}}else g.value=[],h.value=!1},300);Q(u,I);const T=n=>{const e=s.items.findIndex(o=>o.product_id===n.id);if(e>=0){const o=s.items[e];o.quantity<o.max_quantity?(o.quantity+=1,C(e),c()):alert("ไม่สามารถเพิ่มได้ สต็อกไม่เพียงพอ")}else s.items.push({product_id:n.id,product_name:n.name,quantity:1,unit_price:parseFloat(n.selling_price),total_price:parseFloat(n.selling_price),max_quantity:n.current_stock}),c();u.value="",g.value=[],k.value=!1},$=n=>{s.items.splice(n,1),c()},A=n=>{const e=s.items[n];e.quantity<e.max_quantity?(e.quantity+=1,C(n),c()):alert("ไม่สามารถเพิ่มได้ สต็อกไม่เพียงพอ")},z=n=>{const e=s.items[n];e.quantity>1&&(e.quantity-=1,C(n),c())},C=n=>{const e=s.items[n];e.total_price=e.quantity*e.unit_price},N=()=>{w.value?s.tax_amount=s.subtotal*.07:s.tax_amount=0,c()},c=()=>{s.subtotal=s.items.reduce((m,_)=>{const D=parseFloat(_.total_price)||0;return m+D},0),w.value&&(s.tax_amount=Math.round(s.subtotal*.07*100)/100);const n=parseFloat(s.subtotal)||0,e=parseFloat(s.tax_amount)||0,o=parseFloat(s.discount_amount)||0;s.total_amount=Math.round((n+e-o)*100)/100,P()},P=()=>{s.change_amount=Math.max(0,(s.payment_received||0)-s.total_amount)},b=n=>parseFloat(n||0).toFixed(2),R=()=>{if(s.items.length===0){alert("กรุณาเพิ่มสินค้าอย่างน้อย 1 รายการ");return}s.payment_received=s.total_amount,s.change_amount=0,s.put(route("sales.update",l.sale.id),{onSuccess:()=>{alert("บันทึกการแก้ไขสำเร็จ!"),confirm("ต้องการพิมพ์ใบเสร็จหรือไม่?")&&window.open(`/receipts/${l.sale.id}/print`,"_blank","width=800,height=600")},onError:n=>{console.error("Error updating sale:",n),alert("เกิดข้อผิดพลาด: "+(n.message||"ไม่สามารถบันทึกได้"))}})};return(n,e)=>(i(),G(X,{title:"Edit Sale"},{header:V(()=>[t("div",Y,[t("h2",Z," Edit Sale #"+r(q.sale.id.toString().padStart(6,"0")),1),t("div",tt,[j(a(F),{href:n.route("sales.show",q.sale.id),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:V(()=>[...e[8]||(e[8]=[y(" View Sale ",-1)])]),_:1},8,["href"]),j(a(F),{href:n.route("sales.index"),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:V(()=>[...e[9]||(e[9]=[y(" Back to Sales ",-1)])]),_:1},8,["href"])])])]),default:V(()=>[t("div",et,[t("div",st,[t("form",{onSubmit:J(R,["prevent"])},[t("div",ot,[t("div",nt,[t("div",lt,[t("div",at,[e[19]||(e[19]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"เลือกสินค้า",-1)),t("div",rt,[t("div",it,[p(t("input",{ref_key:"searchInput",ref:E,"onUpdate:modelValue":e[0]||(e[0]=o=>u.value=o),type:"text",placeholder:"ค้นหาสินค้าด้วยชื่อ, SKU หรือบาร์โค้ด...",class:"w-full px-4 py-3 pl-10 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all",onFocus:e[1]||(e[1]=o=>k.value=!0)},null,544),[[x,u.value]]),e[11]||(e[11]=t("svg",{class:"absolute left-3 top-3.5 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),h.value?(i(),d("div",dt,[...e[10]||(e[10]=[t("svg",{class:"animate-spin h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):f("",!0)]),u.value.length>0&&u.value.length<2?(i(),d("p",ut," พิมพ์อย่างน้อย 2 ตัวอักษรเพื่อค้นหา... ")):f("",!0)]),k.value&&g.value.length>0?(i(),d("div",ct,[(i(!0),d(U,null,B(g.value,o=>(i(),d("div",{key:o.id,onClick:m=>T(o),class:"p-4 border-b last:border-b-0 hover:bg-green-50 cursor-pointer transition-colors duration-150"},[t("div",pt,[t("div",gt,[t("div",_t,r(o.name),1),t("div",xt,[t("span",bt,[e[12]||(e[12]=t("svg",{class:"w-4 h-4 mr-1 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1)),e[13]||(e[13]=y(" คงเหลือ: ",-1)),t("strong",vt,r(o.current_stock),1)]),t("span",yt,[e[14]||(e[14]=t("svg",{class:"w-4 h-4 mr-1 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})],-1)),e[15]||(e[15]=y(" ราคา: ",-1)),t("strong",ht,"฿"+r(b(o.selling_price)),1)]),o.sku?(i(),d("span",ft," SKU: "+r(o.sku),1)):f("",!0)])]),e[16]||(e[16]=t("button",{type:"button",class:"ml-4 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-150 flex items-center"},[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})]),y(" เพิ่ม ")],-1))])],8,mt))),128))])):f("",!0),k.value&&u.value.length>=2&&g.value.length===0&&!h.value?(i(),d("div",wt,[e[17]||(e[17]=t("svg",{class:"w-12 h-12 mx-auto mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),y(' ไม่พบสินค้าที่ค้นหา "'+r(u.value)+'" ',1)])):f("",!0),a(s).items.length>0?(i(),d("div",kt,[e[18]||(e[18]=t("h4",{class:"text-md font-medium text-gray-900 mb-3"},"รายการสินค้าที่เลือก",-1)),t("div",Ct,[(i(!0),d(U,null,B(a(s).items,(o,m)=>(i(),d("div",{key:m,class:"flex items-center space-x-3 p-3 border rounded-md"},[t("div",Vt,[t("div",qt,r(o.product_name),1),t("div",Mt,"ราคา: ฿"+r(b(o.unit_price)),1)]),t("div",St,[t("button",{type:"button",onClick:_=>z(m),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-2 py-1 rounded"}," - ",8,jt),p(t("input",{"onUpdate:modelValue":_=>o.quantity=_,type:"number",min:"1",max:o.max_quantity,onInput:_=>C(m),class:"w-16 px-2 py-1 border border-gray-300 rounded text-center"},null,40,Ft),[[x,o.quantity,void 0,{number:!0}]]),t("button",{type:"button",onClick:_=>A(m),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-2 py-1 rounded"}," + ",8,Ut)]),t("div",Bt,[t("div",Et,"฿"+r(b(o.total_price)),1)]),t("button",{type:"button",onClick:_=>$(m),class:"text-red-600 hover:text-red-900"}," ลบ ",8,It)]))),128))])])):(i(),d("div",Tt," ค้นหาและเลือกสินค้าเพื่อเพิ่มในรายการขาย "))])])]),t("div",$t,[t("div",At,[t("div",zt,[e[23]||(e[23]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"ข้อมูลลูกค้า",-1)),t("div",Nt,[t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ชื่อลูกค้า ",-1)),p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>a(s).customer_name=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ไม่บังคับ"},null,512),[[x,a(s).customer_name]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," เบอร์โทรศัพท์ ",-1)),p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>a(s).customer_phone=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ไม่บังคับ"},null,512),[[x,a(s).customer_phone]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," อีเมล ",-1)),p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>a(s).customer_email=o),type:"email",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ไม่บังคับ"},null,512),[[x,a(s).customer_email]])])])])]),t("div",Pt,[t("div",Rt,[e[28]||(e[28]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"สรุปยอดขาย",-1)),t("div",Dt,[t("div",Lt,[e[24]||(e[24]=t("span",null,"ยอดรวม:",-1)),t("span",null,"฿"+r(b(a(s).subtotal)),1)]),t("div",Ht,[e[25]||(e[25]=t("label",{class:"text-sm font-medium text-gray-700"}," ส่วนลด: ",-1)),p(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>a(s).discount_amount=o),type:"number",min:"0",step:"0.01",onInput:c,class:"w-24 px-2 py-1 border border-gray-300 rounded text-right"},null,544),[[x,a(s).discount_amount,void 0,{number:!0}]])]),t("div",Kt,[t("div",Ot,[p(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>w.value=o),type:"checkbox",onChange:N,class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,544),[[W,w.value]]),e[26]||(e[26]=t("label",{class:"text-sm font-medium text-gray-700"}," ภาษีมูลค่าเพิ่ม (VAT 7%) ",-1))]),t("span",Qt," ฿"+r(b(a(s).tax_amount||0)),1)]),t("div",Gt,[t("div",Jt,[e[27]||(e[27]=t("span",null,"ยอดรวมสุทธิ:",-1)),t("span",Wt,"฿"+r(b(a(s).total_amount)),1)])])])])]),t("div",Xt,[t("div",Yt,[e[29]||(e[29]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"หมายเหตุ",-1)),t("div",null,[p(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=o=>a(s).notes=o),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"หมายเหตุเพิ่มเติม (ถ้ามี)..."},null,512),[[x,a(s).notes]])])])]),t("div",Zt,[t("div",te,[t("button",{type:"submit",disabled:a(s).items.length===0||a(s).processing,class:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-bold py-3 px-4 rounded text-lg transition ease-in-out duration-150"},r(a(s).processing?"กำลังบันทึก...":"บันทึกการแก้ไข"),9,ee)])])])])],32)])])]),_:1}))}};export{re as default};
