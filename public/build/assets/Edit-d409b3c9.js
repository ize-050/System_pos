import{u as A,r as k,o as F,H as M,f as N,w as T,a as i,d as O,e as f,b as t,t as r,i as S,p as q,l as a,z as C,s as Q,g as d,v as u,c as m,F as V,k as U,j as h,h as D}from"./app-6ba43703.js";import{A as R}from"./AppLayout-ac0cd7e0.js";/* empty css            */import"./ApplicationLogo-9fe9ca86.js";import"./_plugin-vue_export-helper-c27b6911.js";/* empty css                                                                  */const L={class:"flex justify-between items-center"},z={class:"font-semibold text-xl text-gray-800 leading-tight"},H={class:"space-x-2"},W={class:"py-12"},G={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},J={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},K={class:"lg:col-span-2"},X={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Y={class:"p-6"},Z={class:"mb-4"},tt={key:0,class:"mb-6 max-h-60 overflow-y-auto border rounded-md"},et=["onClick"],ot={class:"font-medium"},st={class:"text-sm text-gray-500"},nt={key:1},at={class:"space-y-3"},lt={class:"flex-1"},rt={class:"font-medium"},dt={class:"text-sm text-gray-500"},it={class:"flex items-center space-x-2"},ut=["onClick"],mt=["onUpdate:modelValue","max","onInput"],ct=["onClick"],pt={class:"text-right"},yt={class:"font-medium"},bt=["onClick"],gt={key:2,class:"text-center py-8 text-gray-500"},xt={class:"space-y-6"},_t={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},vt={class:"p-6"},ft={class:"space-y-4"},ht={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},wt={class:"p-6"},kt={class:"space-y-3"},St={class:"flex justify-between"},qt={class:"flex justify-between items-center"},Ct={class:"flex justify-between items-center"},Vt={class:"border-t pt-3"},Ut={class:"flex justify-between text-lg font-bold"},Bt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Et={class:"p-6"},It={class:"space-y-4"},Pt={key:0,class:"text-red-600 text-sm mt-1"},$t={key:0,class:"text-red-600 text-sm mt-1"},jt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},At={class:"p-6"},Ft=["disabled"],Rt={__name:"Edit",props:{sale:Object,errors:Object},setup(c){const l=c,o=A({customer_name:l.sale.customer_name||"",customer_phone:l.sale.customer_phone||"",customer_email:l.sale.customer_email||"",items:[],subtotal:l.sale.subtotal||0,tax_amount:l.sale.tax_amount||0,discount_amount:l.sale.discount_amount||0,total_amount:l.sale.total_amount||0,payment_method:l.sale.payment_method||"",payment_received:l.sale.payment_received||0,change_amount:l.sale.change_amount||0,notes:l.sale.notes||""}),y=k(""),b=k([]);F(()=>{l.sale.items&&(o.items=l.sale.items.map(s=>({product_id:s.product_id,product_name:s.product.name,quantity:s.quantity,unit_price:s.unit_price,total_price:s.total_price,max_quantity:s.product.stock_quantity+s.quantity})))});const B=M.debounce(async()=>{if(y.value.length>=2)try{const s=await N.get(route("sales.search-products"),{params:{search:y.value}});b.value=s.data}catch(s){console.error("Error searching products:",s),b.value=[]}else b.value=[]},300);T(y,B);const E=s=>{const e=o.items.findIndex(n=>n.product_id===s.id);e>=0?o.items[e].quantity<s.stock_quantity?(o.items[e].quantity+=1,v(e)):alert("Cannot add more items. Stock limit reached."):o.items.push({product_id:s.id,product_name:s.name,quantity:1,unit_price:s.selling_price,total_price:s.selling_price,max_quantity:s.stock_quantity}),p(),y.value="",b.value=[]},I=s=>{o.items.splice(s,1),p()},P=s=>{const e=o.items[s];e.quantity<e.max_quantity?(e.quantity+=1,v(s),p()):alert("Cannot add more items. Stock limit reached.")},$=s=>{const e=o.items[s];e.quantity>1&&(e.quantity-=1,v(s),p())},v=s=>{const e=o.items[s];e.total_price=e.quantity*e.unit_price,p()},p=()=>{o.subtotal=o.items.reduce((s,e)=>s+e.total_price,0),o.total_amount=o.subtotal+(o.tax_amount||0)-(o.discount_amount||0),w()},w=()=>{o.change_amount=Math.max(0,(o.payment_received||0)-o.total_amount)},x=s=>parseFloat(s||0).toFixed(2),j=()=>{if(o.items.length===0){alert("Please add at least one item to the sale.");return}o.put(route("sales.update",l.sale.id),{onSuccess:()=>{}})};return(s,e)=>(i(),O(R,{title:"Edit Sale"},{header:f(()=>[t("div",L,[t("h2",z," Edit Sale #"+r(c.sale.id.toString().padStart(6,"0")),1),t("div",H,[S(a(C),{href:s.route("sales.show",c.sale.id),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:f(()=>[...e[10]||(e[10]=[q(" View Sale ",-1)])]),_:1},8,["href"]),S(a(C),{href:s.route("sales.index"),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:f(()=>[...e[11]||(e[11]=[q(" Back to Sales ",-1)])]),_:1},8,["href"])])])]),default:f(()=>[t("div",W,[t("div",G,[t("form",{onSubmit:Q(j,["prevent"])},[t("div",J,[t("div",K,[t("div",X,[t("div",Y,[e[14]||(e[14]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Product Selection",-1)),t("div",Z,[d(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>y.value=n),type:"text",placeholder:"Search products by name or barcode...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none transition ease-in-out duration-150",style:{"border-color":"#E2E8F0"},onfocus:"this.style.borderColor='#6B7B47'; this.style.boxShadow='0 0 0 3px rgba(107, 123, 71, 0.2)'",onblur:"this.style.borderColor='#E2E8F0'; this.style.boxShadow='none'"},null,512),[[u,y.value]])]),b.value.length>0?(i(),m("div",tt,[(i(!0),m(V,null,U(b.value,n=>(i(),m("div",{key:n.id,onClick:g=>E(n),class:"p-3 border-b hover:bg-gray-50 cursor-pointer flex justify-between items-center"},[t("div",null,[t("div",ot,r(n.name),1),t("div",st," Stock: "+r(n.stock_quantity)+" | Price: $"+r(x(n.selling_price)),1)]),e[12]||(e[12]=t("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm"}," Add ",-1))],8,et))),128))])):h("",!0),a(o).items.length>0?(i(),m("div",nt,[e[13]||(e[13]=t("h4",{class:"text-md font-medium text-gray-900 mb-3"},"Selected Items",-1)),t("div",at,[(i(!0),m(V,null,U(a(o).items,(n,g)=>(i(),m("div",{key:g,class:"flex items-center space-x-3 p-3 border rounded-md"},[t("div",lt,[t("div",rt,r(n.product_name),1),t("div",dt,"Price: $"+r(x(n.unit_price)),1)]),t("div",it,[t("button",{type:"button",onClick:_=>$(g),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-2 py-1 rounded"}," - ",8,ut),d(t("input",{"onUpdate:modelValue":_=>n.quantity=_,type:"number",min:"1",max:n.max_quantity,onInput:_=>v(g),class:"w-16 px-2 py-1 border border-gray-300 rounded text-center"},null,40,mt),[[u,n.quantity,void 0,{number:!0}]]),t("button",{type:"button",onClick:_=>P(g),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-2 py-1 rounded"}," + ",8,ct)]),t("div",pt,[t("div",yt,"$"+r(x(n.total_price)),1)]),t("button",{type:"button",onClick:_=>I(g),class:"text-red-600 hover:text-red-900"}," Remove ",8,bt)]))),128))])])):(i(),m("div",gt," Search and select products to add to the sale "))])])]),t("div",xt,[t("div",_t,[t("div",vt,[e[18]||(e[18]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Customer Information",-1)),t("div",ft,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Customer Name ",-1)),d(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>a(o).customer_name=n),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional"},null,512),[[u,a(o).customer_name]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Phone Number ",-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>a(o).customer_phone=n),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional"},null,512),[[u,a(o).customer_phone]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Email ",-1)),d(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>a(o).customer_email=n),type:"email",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional"},null,512),[[u,a(o).customer_email]])])])])]),t("div",ht,[t("div",wt,[e[23]||(e[23]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Sale Summary",-1)),t("div",kt,[t("div",St,[e[19]||(e[19]=t("span",null,"Subtotal:",-1)),t("span",null,"$"+r(x(a(o).subtotal)),1)]),t("div",qt,[e[20]||(e[20]=t("label",{class:"text-sm font-medium text-gray-700"}," Discount Amount: ",-1)),d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>a(o).discount_amount=n),type:"number",min:"0",step:"0.01",onInput:p,class:"w-24 px-2 py-1 border border-gray-300 rounded text-right"},null,544),[[u,a(o).discount_amount,void 0,{number:!0}]])]),t("div",Ct,[e[21]||(e[21]=t("label",{class:"text-sm font-medium text-gray-700"}," Tax Amount: ",-1)),d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>a(o).tax_amount=n),type:"number",min:"0",step:"0.01",onInput:p,class:"w-24 px-2 py-1 border border-gray-300 rounded text-right"},null,544),[[u,a(o).tax_amount,void 0,{number:!0}]])]),t("div",Vt,[t("div",Ut,[e[22]||(e[22]=t("span",null,"Total:",-1)),t("span",null,"$"+r(x(a(o).total_amount)),1)])])])])]),t("div",Bt,[t("div",Et,[e[29]||(e[29]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Payment Information",-1)),t("div",It,[t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Payment Method * ",-1)),d(t("select",{"onUpdate:modelValue":e[6]||(e[6]=n=>a(o).payment_method=n),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},[...e[24]||(e[24]=[t("option",{value:""},"Select Payment Method",-1),t("option",{value:"cash"},"Cash",-1),t("option",{value:"card"},"Card",-1),t("option",{value:"bank_transfer"},"Bank Transfer",-1),t("option",{value:"e_wallet"},"E-Wallet",-1)])],512),[[D,a(o).payment_method]]),c.errors.payment_method?(i(),m("div",Pt,r(c.errors.payment_method),1)):h("",!0)]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Payment Received * ",-1)),d(t("input",{"onUpdate:modelValue":e[7]||(e[7]=n=>a(o).payment_received=n),type:"number",min:"0",step:"0.01",onInput:w,class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,544),[[u,a(o).payment_received,void 0,{number:!0}]]),c.errors.payment_received?(i(),m("div",$t,r(c.errors.payment_received),1)):h("",!0)]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Change Amount ",-1)),d(t("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>a(o).change_amount=n),type:"number",step:"0.01",class:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100",readonly:""},null,512),[[u,a(o).change_amount]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Notes ",-1)),d(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=n=>a(o).notes=n),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional notes..."},null,512),[[u,a(o).notes]])])])])]),t("div",jt,[t("div",At,[t("button",{type:"submit",disabled:a(o).items.length===0||a(o).processing,class:"w-full bg-blue-500 hover:bg-blue-700 disabled:bg-gray-400 text-white font-bold py-3 px-4 rounded text-lg transition ease-in-out duration-150",style:{"background-color":"#6B7B47"},onmouseover:"this.style.backgroundColor='#8A9B5A'",onmouseout:"this.style.backgroundColor='#6B7B47'"},r(a(o).processing?"Updating...":"Update Sale"),9,Ft)])])])])],32)])])]),_:1}))}};export{Rt as default};
