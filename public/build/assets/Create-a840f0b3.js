import{r as v,B as O,z as G,o as J,a as r,c as K,w as k,d as e,g as i,e as y,v as M,F as B,h as T,t as l,i as C,n as P,m as D,f as N,j as W,k as X,x as Y,E as F}from"./app-52dfa1a6.js";import{A as Z}from"./AppLayout-39f8b0fe.js";/* empty css            */import"./ApplicationLogo-8547e154.js";import"./_plugin-vue_export-helper-c27b6911.js";const ee={class:"py-12"},te={class:"max-w-4xl mx-auto sm:px-6 lg:px-8"},se={class:"bg-white rounded-lg shadow p-6"},oe={key:0,class:"space-y-6"},le={class:"relative"},ne={key:0,class:"absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-60 overflow-auto"},ae=["onClick"],re={class:"flex justify-between items-center"},de={class:"font-medium text-blue-600"},ie={class:"text-gray-500 ml-2"},ue={class:"text-right"},ce={class:"font-medium"},pe={class:"text-xs text-gray-500"},ve={key:1,class:"space-y-6"},me={class:"bg-gray-50 p-4 rounded-lg"},ge={class:"flex justify-between items-start"},xe={class:"font-medium text-gray-900"},_e={class:"text-sm text-gray-500"},fe={class:"text-sm text-gray-500"},ye={class:"space-y-3"},be={class:"flex items-center gap-4"},he=["checked","onChange"],we={class:"flex-1"},ke={class:"font-medium"},Ce={class:"text-sm text-gray-500"},Ie={class:"text-green-600"},Se={key:0,class:"flex items-center gap-3"},qe=["value","onInput","max"],je=["value","onChange"],Ve={class:"flex items-center gap-1"},Me=["checked","onChange"],Be={key:0,class:"border-t pt-6 space-y-4"},Te={class:"grid grid-cols-2 gap-4"},De={class:"bg-gray-50 p-4 rounded-lg"},Ne={class:"flex justify-between text-sm mb-2"},Fe={class:"flex justify-between text-sm mb-2"},Le={class:"flex justify-between text-lg font-bold border-t pt-2 mt-2"},Ue={class:"text-red-600"},ze={class:"flex justify-end gap-3"},Re=["disabled"],Oe={__name:"Create",props:{sale:Object,saleItems:Array},setup(L){const m=L,g=v(""),x=v([]),u=v(m.sale||null),b=v(m.saleItems||[]),a=v([]),_=v(!1),d=O({refund_method:"cash",reason:"",notes:""});let I=null;const U=()=>{if(clearTimeout(I),g.value.length<2){x.value=[];return}I=setTimeout(async()=>{try{const o=await fetch(`/refunds/search-sale?q=${encodeURIComponent(g.value)}`);x.value=await o.json()}catch(o){console.error("Search error:",o)}},300)},z=o=>{F.get(route("refunds.create"),{sale_id:o.id},{preserveState:!1})},R=()=>{u.value=null,b.value=[],a.value=[],g.value="",x.value=[]},h=o=>a.value.some(t=>t.sale_item_id===o),c=o=>a.value.find(t=>t.sale_item_id===o),A=o=>{const t=a.value.findIndex(n=>n.sale_item_id===o.id);t>=0?a.value.splice(t,1):a.value.push({sale_item_id:o.id,product_id:o.product_id,product_name:o.product_name,quantity:1,unit_price:o.unit_price,max_quantity:o.quantity_available,condition:"good",return_to_stock:!0})},$=(o,t)=>{const n=c(o);if(n){const s=parseInt(t)||1;n.quantity=Math.min(Math.max(1,s),n.max_quantity)}},E=(o,t)=>{const n=c(o);n&&(n.condition=t,t!=="good"&&(n.return_to_stock=!1))},H=(o,t)=>{const n=c(o);n&&(n.return_to_stock=t)},S=G(()=>a.value.reduce((o,t)=>o+t.unit_price*t.quantity,0)),f=o=>parseFloat(o||0).toLocaleString("th-TH",{minimumFractionDigits:2}),q=o=>o?new Date(o).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric"}):"-",Q=()=>{if(a.value.length===0){alert("กรุณาเลือกสินค้าที่ต้องการคืน");return}_.value=!0,F.post(route("refunds.store"),{sale_id:u.value.id,items:a.value,refund_method:d.refund_method,reason:d.reason,notes:d.notes},{onFinish:()=>{_.value=!1}})};return J(()=>{m.sale&&(u.value=m.sale,b.value=m.saleItems||[])}),(o,t)=>(r(),K(Z,{title:"สร้างใบคืนสินค้า"},{header:k(()=>[...t[4]||(t[4]=[e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"สร้างใบคืนสินค้า",-1)])]),default:k(()=>{var n;return[e("div",ee,[e("div",te,[e("div",se,[u.value?(r(),i("div",ve,[e("div",me,[e("div",ge,[e("div",null,[e("h3",xe,"บิลอ้างอิง: "+l(u.value.sale_number),1),e("p",_e,"ลูกค้า: "+l(((n=u.value.customer)==null?void 0:n.name)||"ลูกค้าทั่วไป"),1),e("p",fe,"วันที่ขาย: "+l(q(u.value.sale_date)),1)]),e("button",{onClick:R,class:"text-gray-400 hover:text-gray-600"},[...t[7]||(t[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",null,[t[12]||(t[12]=e("h4",{class:"font-medium text-gray-900 mb-3"},"เลือกสินค้าที่ต้องการคืน",-1)),e("div",ye,[(r(!0),i(B,null,T(b.value,s=>{var w,j,V;return r(),i("div",{key:s.id,class:P(["border rounded-lg p-4",h(s.id)?"border-blue-500 bg-blue-50":"border-gray-200"])},[e("div",be,[e("input",{type:"checkbox",checked:h(s.id),onChange:p=>A(s),class:"h-5 w-5 text-blue-600 rounded"},null,40,he),e("div",we,[e("div",ke,l(s.product_name),1),e("div",Ce,[D(" ราคา: ฿"+l(f(s.unit_price))+" | ซื้อ: "+l(s.quantity_sold)+" ชิ้น | คืนแล้ว: "+l(s.quantity_refunded)+" ชิ้น | ",1),e("span",Ie,"คืนได้: "+l(s.quantity_available)+" ชิ้น",1)])]),h(s.id)?(r(),i("div",Se,[e("div",null,[t[8]||(t[8]=e("label",{class:"text-xs text-gray-500"},"จำนวนคืน",-1)),e("input",{type:"number",value:(w=c(s.id))==null?void 0:w.quantity,onInput:p=>$(s.id,p.target.value),max:s.quantity_available,min:"1",class:"w-20 px-2 py-1 border rounded text-center"},null,40,qe)]),e("div",null,[t[10]||(t[10]=e("label",{class:"text-xs text-gray-500"},"สภาพ",-1)),e("select",{value:(j=c(s.id))==null?void 0:j.condition,onChange:p=>E(s.id,p.target.value),class:"px-2 py-1 border rounded"},[...t[9]||(t[9]=[e("option",{value:"good"},"สภาพดี",-1),e("option",{value:"damaged"},"เสียหาย",-1),e("option",{value:"defective"},"ชำรุด",-1)])],40,je)]),e("div",Ve,[e("input",{type:"checkbox",checked:(V=c(s.id))==null?void 0:V.return_to_stock,onChange:p=>H(s.id,p.target.checked),class:"h-4 w-4"},null,40,Me),t[11]||(t[11]=e("label",{class:"text-xs text-gray-500"},"คืนสต็อก",-1))])])):C("",!0)])],2)}),128))])]),a.value.length>0?(r(),i("div",Be,[e("div",Te,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"วิธีคืนเงิน",-1)),y(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>d.refund_method=s),class:"w-full px-3 py-2 border rounded-lg"},[...t[13]||(t[13]=[e("option",{value:"cash"},"เงินสด",-1),e("option",{value:"transfer"},"โอนเงิน",-1),e("option",{value:"credit_card"},"บัตรเครดิต",-1),e("option",{value:"store_credit"},"เครดิตร้าน",-1)])],512),[[N,d.refund_method]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"เหตุผลการคืน",-1)),y(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>d.reason=s),class:"w-full px-3 py-2 border rounded-lg"},[...t[15]||(t[15]=[e("option",{value:""},"เลือกเหตุผล",-1),e("option",{value:"ไซส์ไม่พอดี"},"ไซส์ไม่พอดี",-1),e("option",{value:"สินค้าชำรุด"},"สินค้าชำรุด",-1),e("option",{value:"ไม่ตรงตามสั่ง"},"ไม่ตรงตามสั่ง",-1),e("option",{value:"เปลี่ยนใจ"},"เปลี่ยนใจ",-1),e("option",{value:"อื่นๆ"},"อื่นๆ",-1)])],512),[[N,d.reason]])])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"หมายเหตุเพิ่มเติม",-1)),y(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=s=>d.notes=s),rows:"2",class:"w-full px-3 py-2 border rounded-lg",placeholder:"รายละเอียดเพิ่มเติม..."},null,512),[[M,d.notes]])]),e("div",De,[e("div",Ne,[t[18]||(t[18]=e("span",null,"จำนวนรายการ:",-1)),e("span",null,l(a.value.length)+" รายการ",1)]),e("div",Fe,[t[19]||(t[19]=e("span",null,"ยอดรวม:",-1)),e("span",null,"฿"+l(f(S.value)),1)]),e("div",Le,[t[20]||(t[20]=e("span",null,"ยอดคืนทั้งหมด:",-1)),e("span",Ue,"฿"+l(f(S.value)),1)])]),e("div",ze,[W(X(Y),{href:o.route("refunds.index"),class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"},{default:k(()=>[...t[21]||(t[21]=[D(" ยกเลิก ",-1)])]),_:1},8,["href"]),e("button",{onClick:Q,disabled:_.value,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"},l(_.value?"กำลังบันทึก...":"สร้างใบคืนสินค้า"),9,Re)])])):C("",!0)])):(r(),i("div",oe,[t[5]||(t[5]=e("h3",{class:"text-lg font-medium text-gray-900"},"ค้นหาบิลขาย",-1)),e("div",le,[y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s),type:"text",placeholder:"พิมพ์เลขที่บิล เช่น INV20251205...",class:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onInput:U},null,544),[[M,g.value]]),x.value.length>0?(r(),i("div",ne,[(r(!0),i(B,null,T(x.value,s=>(r(),i("div",{key:s.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0",onClick:w=>z(s)},[e("div",re,[e("div",null,[e("span",de,l(s.sale_number),1),e("span",ie,l(s.customer_name),1)]),e("div",ue,[e("div",ce,"฿"+l(f(s.total_amount)),1),e("div",pe,l(q(s.sale_date)),1)])])],8,ae))),128))])):C("",!0)]),t[6]||(t[6]=e("div",{class:"text-center text-gray-500 py-8"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 mx-auto text-gray-300 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})]),e("p",null,"ค้นหาบิลขายที่ต้องการคืนสินค้า")],-1))]))])])])]}),_:1}))}};export{Oe as default};
