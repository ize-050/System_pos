import{r as P,a as n,c as j,w as x,d as t,t as o,j as S,m as g,k as p,x as b,i,n as v,g as d,h as C,F as B,e as O,v as U,E as $}from"./app-68daac91.js";import{A as G}from"./AppLayout-ea36af8e.js";/* empty css            */import"./ApplicationLogo-9b15c312.js";import"./_plugin-vue_export-helper-c27b6911.js";const J={class:"flex justify-between items-center"},K={class:"font-semibold text-xl text-gray-800 leading-tight"},W={class:"space-x-2"},X={class:"py-12"},Y={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Z={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},I={class:"lg:col-span-2 space-y-6"},tt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},et={class:"p-6"},st={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ot={class:"mt-1 text-sm text-gray-900"},at={class:"mt-1 text-sm text-gray-900"},lt={class:"mt-1 text-sm text-gray-900"},nt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},dt={class:"p-6"},it={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},rt={class:"mt-1 text-sm text-gray-900"},mt={class:"mt-1 text-sm text-gray-900"},ut={class:"mt-1 text-sm text-gray-900"},ct={key:0},xt={class:"mt-1 text-sm text-gray-900"},gt={key:1},yt={class:"mt-1 text-sm text-gray-900"},ft={key:1,class:"text-gray-500 text-sm"},ht={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},pt={class:"p-6"},bt={class:"overflow-x-auto"},vt={class:"min-w-full divide-y divide-gray-200"},wt={class:"bg-white divide-y divide-gray-200"},_t={class:"px-6 py-4 whitespace-nowrap"},kt={class:"flex items-center"},jt={key:0,class:"flex-shrink-0 h-10 w-10"},St=["src","alt"],Ct={class:"ml-4"},Bt={class:"text-sm font-medium text-gray-900"},$t={key:0,class:"text-sm text-gray-500"},At={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Dt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Tt={class:"px-6 py-4 whitespace-nowrap text-sm"},qt={key:0,class:"text-red-600 font-medium"},Et={key:1,class:"text-gray-400"},Ft={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},Mt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Pt={key:0,class:"bg-white overflow-hidden shadow-sm sm:rounded-lg border-l-4 border-red-500"},Vt={class:"p-6"},Lt={class:"text-lg font-medium text-red-600 mb-4 flex items-center"},Nt={class:"space-y-4"},Qt={class:"flex justify-between items-start mb-2"},Rt={class:"text-sm font-medium text-gray-900"},zt={class:"text-red-600 font-bold"},Ht={key:0,class:"mt-2"},Ot={class:"text-sm text-gray-700 space-y-1"},Ut={class:"text-red-600"},Gt={key:1,class:"mt-2 text-sm text-gray-600"},Jt={class:"mt-4 pt-4 border-t border-red-200"},Kt={class:"flex justify-between text-sm"},Wt={class:"font-bold text-red-600"},Xt={class:"flex justify-between text-sm mt-1"},Yt={class:"font-bold text-green-600"},Zt={key:1,class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},It={class:"p-6"},te={class:"text-sm text-gray-700"},ee={class:"space-y-6"},se={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},oe={class:"p-6"},ae={class:"space-y-3"},le={class:"flex justify-between"},ne={class:"text-sm font-medium text-gray-900"},de={key:0,class:"flex justify-between"},ie={class:"text-sm font-medium text-blue-600"},re={key:1,class:"flex justify-between"},me={class:"text-sm font-medium text-red-600"},ue={key:2,class:"flex justify-between"},ce={class:"text-sm font-medium text-gray-900"},xe={key:3,class:"flex justify-between"},ge={class:"text-sm font-medium text-gray-900"},ye={class:"border-t pt-3"},fe={class:"flex justify-between"},he={class:"text-base font-bold text-gray-900"},pe={class:"border-t pt-3 space-y-2"},be={class:"flex justify-between"},ve={class:"text-sm font-medium text-green-600"},we={class:"flex justify-between"},_e={class:"text-sm font-medium text-blue-600"},ke={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},je={class:"p-6"},Se={class:"space-y-3"},Ce={class:"flex justify-between"},Be={class:"text-sm font-medium text-gray-900"},$e={class:"flex justify-between"},Ae={class:"text-sm font-medium text-gray-900"},De={class:"flex justify-between"},Te={class:"text-sm font-medium text-gray-900"},qe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ee={class:"p-6"},Fe={class:"space-y-3"},Me={class:"mt-1 text-sm text-gray-900"},Pe={key:0},Ve={class:"mt-1 text-sm text-gray-900"},Le={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ne={class:"p-6"},Qe={class:"space-y-3"},Re={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ze={class:"bg-white rounded-lg p-6 w-96"},He={class:"flex justify-end gap-2"},We={__name:"Show",props:{sale:Object},setup(s){var T,q,E,F;const r=s;console.log("Sale data:",r.sale),console.log("Sale items:",(T=r.sale)==null?void 0:T.sale_items),console.log("Sale items length:",(E=(q=r.sale)==null?void 0:q.saleItems)==null?void 0:E.length);const m=l=>parseFloat(l||0).toFixed(2),V=l=>({cash:"เงินสด",card:"บัตรเครดิต/เดบิต",bank_transfer:"โอนเงิน",e_wallet:"กระเป๋าเงินอิเล็กทรอนิกส์"})[l]||l,L=l=>({cash:"bg-green-100 text-green-800",card:"bg-blue-100 text-blue-800",bank_transfer:"bg-purple-100 text-purple-800",e_wallet:"bg-orange-100 text-orange-800"})[l]||"bg-gray-100 text-gray-800",N=l=>new Date(l).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric"}),w=l=>new Date(l).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),A=()=>{var l;return((l=r.sale.items)==null?void 0:l.reduce((e,u)=>e+u.quantity,0))||0},Q=()=>{const l=r.sale.items||[];if(l.length===0)return 0;const e=l.reduce((a,c)=>a+c.total_price,0),u=A();return u>0?e/u:0},y=l=>{if(!r.sale.refunds||r.sale.refunds.length===0)return 0;let e=0;return r.sale.refunds.forEach(u=>{u.refund_items&&u.refund_items.forEach(a=>{(a.sale_item_id===l.id||a.product_id===l.product_id)&&(e+=a.quantity||0)})}),e},D=()=>!r.sale.refunds||r.sale.refunds.length===0?0:r.sale.refunds.reduce((l,e)=>l+(parseFloat(e.refund_amount)||0),0),_=P(!1),k=P({email:((F=r.sale.customer)==null?void 0:F.email)||""}),R=()=>{window.open(route("receipts.print",r.sale.id),"_blank")},z=()=>{$.post(route("receipts.send-email",r.sale.id),k.value,{onSuccess:()=>{_.value=!1}})},H=()=>{confirm("คุณแน่ใจหรือไม่ที่จะลบการขายนี้? การดำเนินการนี้ไม่สามารถยกเลิกได้")&&$.delete(route("sales.destroy",r.sale.id),{onSuccess:()=>{$.visit(route("sales.index"))}})};return(l,e)=>(n(),j(G,{title:"รายละเอียดการขาย"},{header:x(()=>[t("div",J,[t("h2",K," การขาย #"+o(s.sale.id.toString().padStart(6,"0")),1),t("div",W,[S(p(b),{href:l.route("receipts.preview",s.sale.id),class:"bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded"},{default:x(()=>[...e[3]||(e[3]=[g(" ดูใบเสร็จ ",-1)])]),_:1},8,["href"]),t("button",{onClick:R,class:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"}," พิมพ์ใบเสร็จ "),l.$page.props.auth.user.role==="admin"||l.$page.props.auth.user.role==="manager"?(n(),j(p(b),{key:0,href:l.route("sales.edit",s.sale.id),class:"bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded"},{default:x(()=>[...e[4]||(e[4]=[g(" แก้ไขการขาย ",-1)])]),_:1},8,["href"])):i("",!0),S(p(b),{href:l.route("sales.index"),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:x(()=>[...e[5]||(e[5]=[g(" กลับไปยังรายการขาย ",-1)])]),_:1},8,["href"])])])]),default:x(()=>{var u;return[t("div",X,[t("div",Y,[t("div",Z,[t("div",I,[t("div",tt,[t("div",et,[e[10]||(e[10]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"}," ภาพรวมการขาย ",-1)),t("div",st,[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700"},"รหัสการขาย",-1)),t("p",ot," #"+o(s.sale.id.toString().padStart(6,"0")),1)]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700"},"วันที่ขาย",-1)),t("p",at,o(N(s.sale.created_at)),1)]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700"},"พนักงานขาย",-1)),t("p",lt,o(s.sale.cashier?`${s.sale.cashier.first_name} ${s.sale.cashier.last_name}`:"ไม่ระบุ"),1)]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700"},"วิธีการชำระเงิน",-1)),t("span",{class:v([L(s.sale.payment_method),"mt-1 px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},o(V(s.sale.payment_method)),3)])])])]),t("div",nt,[t("div",dt,[e[16]||(e[16]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"}," ข้อมูลลูกค้า ",-1)),s.sale.customer?(n(),d("div",it,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"},"ชื่อ",-1)),t("p",rt,o(s.sale.customer.name||s.sale.customer.company_name),1)]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700"},"เบอร์โทรศัพท์",-1)),t("p",mt,o(s.sale.customer.phone||"-"),1)]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},"อีเมล",-1)),t("p",ut,o(s.sale.customer.email||"-"),1)]),s.sale.customer.customer_type?(n(),d("div",ct,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"ประเภท",-1)),t("p",xt,o(s.sale.customer.customer_type==="individual"?"บุคคลธรรมดา":"นิติบุคคล"),1)])):i("",!0),s.sale.customer.credit_limit?(n(),d("div",gt,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700"},"วงเงินเครดิต",-1)),t("p",yt," ฿"+o(m(s.sale.customer.credit_limit)),1)])):i("",!0)])):(n(),d("div",ft," ลูกค้าทั่วไป (ไม่มีข้อมูลลูกค้า) "))])]),t("div",ht,[t("div",pt,[e[18]||(e[18]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"}," รายการสินค้า ",-1)),t("div",bt,[t("table",vt,[e[17]||(e[17]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," สินค้า "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," ราคาต่อหน่วย "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," จำนวนซื้อ "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," คืนแล้ว "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," คงเหลือ "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," รวม ")])],-1)),t("tbody",wt,[(n(!0),d(B,null,C(s.sale.sale_items,a=>{var c,f,h;return n(),d("tr",{key:a.id,class:v({"bg-red-50":y(a)>0})},[t("td",_t,[t("div",kt,[(c=a.product)!=null&&c.image?(n(),d("div",jt,[t("img",{class:"h-10 w-10 rounded-full object-cover",src:a.product.image,alt:a.product.name},null,8,St)])):i("",!0),t("div",Ct,[t("div",Bt,o(((f=a.product)==null?void 0:f.name)||"ไม่พบสินค้า"),1),(h=a.product)!=null&&h.category?(n(),d("div",$t,o(a.product.category.name),1)):i("",!0)])])]),t("td",At," ฿"+o(m(a.unit_price)),1),t("td",Dt,o(a.quantity),1),t("td",Tt,[y(a)>0?(n(),d("span",qt," -"+o(y(a)),1)):(n(),d("span",Et,"-"))]),t("td",Ft,[t("span",{class:v(y(a)>0?"text-orange-600":"text-gray-900")},o(a.quantity-y(a)),3)]),t("td",Mt," ฿"+o(m(a.total_price)),1)],2)}),128))])])])])]),s.sale.refunds&&s.sale.refunds.length>0?(n(),d("div",Pt,[t("div",Vt,[t("h3",Lt,[e[19]||(e[19]=t("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1)),g(" ประวัติการคืนสินค้า ("+o(s.sale.refunds.length)+" รายการ) ",1)]),t("div",Nt,[(n(!0),d(B,null,C(s.sale.refunds,a=>(n(),d("div",{key:a.id,class:"border rounded-lg p-4 bg-red-50"},[t("div",Qt,[t("div",null,[t("span",Rt,"คืนเมื่อ: "+o(w(a.created_at)),1),t("span",{class:v(["ml-2 px-2 py-1 text-xs rounded-full",a.status==="completed"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},o(a.status==="completed"?"เสร็จสิ้น":"รอดำเนินการ"),3)]),t("span",zt,"-฿"+o(m(a.refund_amount)),1)]),a.refund_items&&a.refund_items.length>0?(n(),d("div",Ht,[e[20]||(e[20]=t("p",{class:"text-xs text-gray-500 mb-1"}," สินค้าที่คืน: ",-1)),t("ul",Ot,[(n(!0),d(B,null,C(a.refund_items,c=>{var f,h,M;return n(),d("li",{key:c.id,class:"flex justify-between"},[t("span",null,o(((f=c.product)==null?void 0:f.name)||((M=(h=c.sale_item)==null?void 0:h.product)==null?void 0:M.name)||"สินค้า"),1),t("span",Ut,"x"+o(c.quantity),1)])}),128))])])):i("",!0),a.reason?(n(),d("div",Gt,[e[21]||(e[21]=t("span",{class:"font-medium"},"เหตุผล:",-1)),g(" "+o(a.reason),1)])):i("",!0)]))),128))]),t("div",Jt,[t("div",Kt,[e[22]||(e[22]=t("span",{class:"font-medium text-gray-700"},"ยอดคืนรวม:",-1)),t("span",Wt,"-฿"+o(m(D())),1)]),t("div",Xt,[e[23]||(e[23]=t("span",{class:"font-medium text-gray-700"},"ยอดสุทธิหลังคืน:",-1)),t("span",Yt,"฿"+o(m(s.sale.total_amount-D())),1)])])])])):i("",!0),s.sale.notes?(n(),d("div",Zt,[t("div",It,[e[24]||(e[24]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"}," หมายเหตุ ",-1)),t("p",te,o(s.sale.notes),1)])])):i("",!0)]),t("div",ee,[t("div",se,[t("div",oe,[e[33]||(e[33]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"}," สรุปการเงิน ",-1)),t("div",ae,[t("div",le,[e[25]||(e[25]=t("span",{class:"text-sm text-gray-600"},"ยอดรวมย่อย:",-1)),t("span",ne,"฿"+o(m(s.sale.subtotal)),1)]),s.sale.promotion?(n(),d("div",de,[e[26]||(e[26]=t("span",{class:"text-sm text-gray-600"},"โปรโมชั่น:",-1)),t("span",ie,o(s.sale.promotion.name),1)])):i("",!0),s.sale.discount_amount>0?(n(),d("div",re,[e[27]||(e[27]=t("span",{class:"text-sm text-gray-600"},"ส่วนลด:",-1)),t("span",me,"-฿"+o(m(s.sale.discount_amount)),1)])):i("",!0),s.sale.shipping_fee>0?(n(),d("div",ue,[e[28]||(e[28]=t("span",{class:"text-sm text-gray-600"},"ค่าจัดส่ง:",-1)),t("span",ce,"฿"+o(m(s.sale.shipping_fee)),1)])):i("",!0),s.sale.tax_amount>0?(n(),d("div",xe,[e[29]||(e[29]=t("span",{class:"text-sm text-gray-600"},"ภาษี:",-1)),t("span",ge,"฿"+o(m(s.sale.tax_amount)),1)])):i("",!0),t("div",ye,[t("div",fe,[e[30]||(e[30]=t("span",{class:"text-base font-medium text-gray-900"},"ยอดรวมทั้งหมด:",-1)),t("span",he,"฿"+o(m(s.sale.total_amount)),1)])]),t("div",pe,[t("div",be,[e[31]||(e[31]=t("span",{class:"text-sm text-gray-600"},"จำนวนเงินที่ได้รับ:",-1)),t("span",ve,"฿"+o(m(s.sale.payment_received)),1)]),t("div",we,[e[32]||(e[32]=t("span",{class:"text-sm text-gray-600"},"เงินทอน:",-1)),t("span",_e,"฿"+o(m(s.sale.change_amount)),1)])])])])]),t("div",ke,[t("div",je,[e[37]||(e[37]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"}," สถิติการขาย ",-1)),t("div",Se,[t("div",Ce,[e[34]||(e[34]=t("span",{class:"text-sm text-gray-600"},"จำนวนรายการสินค้า:",-1)),t("span",Be,o(((u=s.sale.items)==null?void 0:u.length)||0),1)]),t("div",$e,[e[35]||(e[35]=t("span",{class:"text-sm text-gray-600"},"จำนวนสินค้าทั้งหมด:",-1)),t("span",Ae,o(A()),1)]),t("div",De,[e[36]||(e[36]=t("span",{class:"text-sm text-gray-600"},"ราคาเฉลี่ยต่อรายการ:",-1)),t("span",Te,"฿"+o(m(Q())),1)])])])]),t("div",qe,[t("div",Ee,[e[40]||(e[40]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"}," ข้อมูลเวลา ",-1)),t("div",Fe,[t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-700"},"วันที่สร้าง",-1)),t("p",Me,o(w(s.sale.created_at)),1)]),s.sale.updated_at!==s.sale.created_at?(n(),d("div",Pe,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-gray-700"},"วันที่อัปเดตล่าสุด",-1)),t("p",Ve,o(w(s.sale.updated_at)),1)])):i("",!0)])])]),t("div",Le,[t("div",Ne,[e[43]||(e[43]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"}," การดำเนินการ ",-1)),t("div",Qe,[S(p(b),{href:l.route("sales.receipt",s.sale.id),class:"w-full bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded text-center block transition ease-in-out duration-150",style:{"background-color":"#6b7b47"},onmouseover:"this.style.backgroundColor='#8A9B5A'",onmouseout:"this.style.backgroundColor='#6B7B47'",target:"_blank"},{default:x(()=>[...e[41]||(e[41]=[g(" พิมพ์ใบเสร็จ ",-1)])]),_:1},8,["href"]),l.$page.props.auth.user.role==="admin"||l.$page.props.auth.user.role==="manager"?(n(),j(p(b),{key:0,href:l.route("sales.edit",s.sale.id),class:"w-full text-white font-bold py-2 px-4 rounded text-center block transition ease-in-out duration-150",style:{"background-color":"#6b7b47"},onmouseover:"this.style.backgroundColor='#8A9B5A'",onmouseout:"this.style.backgroundColor='#6B7B47'"},{default:x(()=>[...e[42]||(e[42]=[g(" แก้ไขการขาย ",-1)])]),_:1},8,["href"])):i("",!0),l.$page.props.auth.user.role==="admin"?(n(),d("button",{key:1,onClick:e[0]||(e[0]=a=>H()),class:"w-full bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"}," ลบการขาย ")):i("",!0)])])])])])])]),_.value?(n(),d("div",Re,[t("div",ze,[e[44]||(e[44]=t("h3",{class:"text-lg font-bold mb-4"},"ส่งใบเสร็จทางอีเมล",-1)),O(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>k.value.email=a),type:"email",placeholder:"กรอกอีเมล",required:"",class:"w-full rounded-md border-gray-300 mb-4"},null,512),[[U,k.value.email]]),t("div",He,[t("button",{onClick:e[2]||(e[2]=a=>_.value=!1),class:"px-4 py-2 bg-gray-300 rounded-md"}," ยกเลิก "),t("button",{onClick:z,class:"px-4 py-2 bg-indigo-600 text-white rounded-md"}," ส่ง ")])])])):i("",!0)]}),_:1}))}};export{We as default};
